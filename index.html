<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Forex Market Time (User Timezone)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/tzdata/timezones.json" rel="preload" as="fetch" crossorigin="anonymous">
  <style>
    /* Keep existing styles */
    /* ... */
  </style>
</head>
<body>
  <h1 id="title">Forex Market Sessions</h1>
  <label for="timezone">Timezone:</label>
  <select id="timezone"></select>
  <p id="currentTime"></p>
  <button id="toggleOpenOnly">ğŸ” Show Open Sessions Only</button>
  <button id="langToggle">ğŸŒ Ø§Ù„Ù„ØºØ©: Ø¹Ø±Ø¨ÙŠ</button>
  <button id="themeToggle">ğŸŒ™ Dark Mode</button>
  <div id="sessions"></div>
  <p id="nextSession"></p>

  <script>
    const sessions = [
      { name: 'Frankfurt', open: '07:00', close: '15:00' },
      { name: 'London', open: '08:00', close: '16:00' },
      { name: 'New York', open: '13:00', close: '21:00' },
      { name: 'Sydney', open: '23:00', close: '07:00' },
      { name: 'Tokyo', open: '00:00', close: '08:00' }
    ];

    let showOpenOnly = false;
    let lang = 'en';
    const statusMap = new Map();
    const notifyPrefs = JSON.parse(localStorage.getItem('notifyPrefs') || '{}');
    const theme = localStorage.getItem('theme') || 'dark';
    let currentZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

    if (theme === 'light') document.body.classList.add('light-mode');

    const timezoneSelect = document.getElementById('timezone');

    Intl.supportedValuesOf('timeZone').forEach(zone => {
      const opt = document.createElement('option');
      opt.value = zone;
      opt.textContent = zone;
      if (zone === currentZone) opt.selected = true;
      timezoneSelect.appendChild(opt);
    });

    timezoneSelect.addEventListener('change', () => {
      currentZone = timezoneSelect.value;
      update();
    });

    const texts = {
      en: {
        title: 'Forex Market Sessions',
        current: 'â±ï¸ Current time',
        showOpen: 'ğŸ” Show Open Sessions Only',
        showAll: 'ğŸ“‹ Show All Sessions',
        open: 'ğŸŸ¢ Open',
        closed: 'ğŸ”´ Closed',
        next: 'ğŸ•’ Next session',
        langBtn: 'ğŸŒ Ø§Ù„Ù„ØºØ©: Ø¹Ø±Ø¨ÙŠ',
        alertOn: 'ğŸ””',
        alertOff: 'ğŸ”•',
        dark: 'ğŸŒ™ Dark Mode',
        light: 'â˜€ï¸ Light Mode'
      },
      ar: {
        title: 'Ø¬Ù„Ø³Ø§Øª Ø³ÙˆÙ‚ Ø§Ù„ÙÙˆØ±ÙƒØ³',
        current: 'â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ',
        showOpen: 'ğŸ” Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø© ÙÙ‚Ø·',
        showAll: 'ğŸ“‹ Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª',
        open: 'ğŸŸ¢ Ù…ÙØªÙˆØ­Ø©',
        closed: 'ğŸ”´ Ù…ØºÙ„Ù‚Ø©',
        next: 'ğŸ•’ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©',
        langBtn: 'ğŸŒ Language: English',
        alertOn: 'ğŸ””',
        alertOff: 'ğŸ”•',
        dark: 'ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†',
        light: 'â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­'
      }
    };

    function formatAMPM(date, zone) {
      return new Intl.DateTimeFormat(lang === 'ar' ? 'ar-EG' : 'en-US', {
        hour: 'numeric', minute: '2-digit', hour12: true, timeZone: zone
      }).format(date);
    }

    function parseTime(str, baseDate, zone) {
      const [h, m] = str.split(':').map(Number);
      const date = new Date(baseDate);
      date.setUTCHours(h - new Date().getTimezoneOffset() / 60, m);
      return new Date(date.toLocaleString('en-US', { timeZone: zone }));
    }

    function update() {
      const now = new Date();
      document.getElementById('currentTime').textContent = `${texts[lang].current} (${currentZone}): ${formatAMPM(now, currentZone)}`;

      // Keep rest of your update logic...
    }

    // Call your initialization scripts
    update();
    setInterval(update, 1000);
  </script>
</body>
</html>
