<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Forex Market Time (Algeria)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0f172a;
      color: white;
      padding: 1rem;
      max-width: 720px;
      margin-left: auto;
      margin-right: auto;
    }
    h1 {
      color: #22c55e;
      text-align: center;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    #currentTime, #nextSession {
      text-align: center;
      font-size: 1rem;
      margin-bottom: 1.5rem;
    }
    button {
      display: block;
      width: 100%;
      max-width: 320px;
      margin: 0.5rem auto;
      padding: 0.6rem 1rem;
      background-color: #1e40af;
      border: none;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
    }
    .session {
      background: #1e293b;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1.2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      position: relative;
    }
    .session h3 {
      font-size: 1.2rem;
      margin: 0 0 0.5rem;
    }
    .session p {
      margin: 0.25rem 0;
      font-size: 0.95rem;
    }
    .bar {
      margin-top: 0.5rem;
      height: 10px;
      background: #334155;
      border-radius: 6px;
      overflow: hidden;
    }
    .bar-fill {
      height: 100%;
      transition: width 0.3s ease;
    }
    .open {
      color: #4ade80;
      font-weight: bold;
    }
    .closed {
      color: #f87171;
      font-weight: bold;
    }
    .live-badge {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: #ef4444;
      color: white;
      padding: 0.3rem 0.6rem;
      font-size: 0.75rem;
      font-weight: bold;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h1 id="title">Forex Market Sessions (Algeria Time)</h1>
  <p id="currentTime"></p>
  <button id="toggleOpenOnly">üîç Show Open Sessions Only</button>
  <button id="langToggle">üåê ÿßŸÑŸÑÿ∫ÿ©: ÿπÿ±ÿ®Ÿä</button>
  <div id="sessions"></div>
  <p id="nextSession"></p>

  <script>
    const sessions = [
      { name: 'Frankfurt', open: '07:00', close: '15:00' },
      { name: 'London', open: '08:00', close: '16:00' },
      { name: 'New York', open: '13:00', close: '21:00' },
      { name: 'Sydney', open: '23:00', close: '07:00' },
      { name: 'Tokyo', open: '00:00', close: '08:00' }
    ];

    let showOpenOnly = false;
    let lang = 'en';
    const statusMap = new Map();

    const texts = {
      en: {
        title: 'Forex Market Sessions (Algeria Time)',
        current: '‚è±Ô∏è Current time (Algiers)',
        showOpen: 'üîç Show Open Sessions Only',
        showAll: 'üìã Show All Sessions',
        open: 'üü¢ Open',
        closed: 'üî¥ Closed',
        next: 'üïí Next session',
        langBtn: 'üåê ÿßŸÑŸÑÿ∫ÿ©: ÿπÿ±ÿ®Ÿä'
      },
      ar: {
        title: 'ÿ¨ŸÑÿ≥ÿßÿ™ ÿ≥ŸàŸÇ ÿßŸÑŸÅŸàÿ±ŸÉÿ≥ (ÿ®ÿ™ŸàŸÇŸäÿ™ ÿßŸÑÿ¨ÿ≤ÿßÿ¶ÿ±)',
        current: '‚è±Ô∏è ÿßŸÑŸàŸÇÿ™ ÿßŸÑÿ≠ÿßŸÑŸä (ÿßŸÑÿ¨ÿ≤ÿßÿ¶ÿ±)',
        showOpen: 'üîç ÿπÿ±ÿ∂ ÿßŸÑÿ¨ŸÑÿ≥ÿßÿ™ ÿßŸÑŸÖŸÅÿ™Ÿàÿ≠ÿ© ŸÅŸÇÿ∑',
        showAll: 'üìã ÿπÿ±ÿ∂ ŸÉŸÑ ÿßŸÑÿ¨ŸÑÿ≥ÿßÿ™',
        open: 'üü¢ ŸÖŸÅÿ™Ÿàÿ≠ÿ©',
        closed: 'üî¥ ŸÖÿ∫ŸÑŸÇÿ©',
        next: 'üïí ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÇÿßÿØŸÖÿ©',
        langBtn: 'üåê Language: English'
      }
    };

    function notify(title, body) {
      if (Notification.permission === 'granted') {
        new Notification(title, { body });
      }
    }

    function requestNotificationPermission() {
      if ('Notification' in window && Notification.permission !== 'granted') {
        Notification.requestPermission();
      }
    }

    function parseTime(str) {
      const [h, m] = str.split(':').map(Number);
      const d = new Date();
      d.setHours(h, m, 0, 0);
      return d;
    }

    function formatAMPM(date) {
      let hours = date.getHours();
      const minutes = date.getMinutes();
      const ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12 || 12;
      const mins = minutes < 10 ? '0' + minutes : minutes;
      return `${hours}:${mins} ${ampm}`;
    }

    function updateText() {
      document.getElementById('title').textContent = texts[lang].title;
      document.getElementById('toggleOpenOnly').textContent = showOpenOnly
        ? texts[lang].showAll
        : texts[lang].showOpen;
      document.getElementById('langToggle').textContent = texts[lang].langBtn;
    }

    function update() {
      const now = new Date();
      const currentTime = formatAMPM(now);
      document.getElementById('currentTime').textContent = `${texts[lang].current}: ${currentTime}`;

      const container = document.getElementById('sessions');
      container.innerHTML = '';
      let next = null;

      sessions.forEach(s => {
        const open = parseTime(s.open);
        let close = parseTime(s.close);
        if (close <= open) close.setDate(close.getDate() + 1);

        const total = close - open;
        const elapsed = now - open;
        const isOpen = elapsed >= 0 && now <= close;
        const pct = Math.max(0, Math.min(100, (elapsed / total) * 100));

        if (statusMap.has(s.name)) {
          const prev = statusMap.get(s.name);
          if (prev !== isOpen) {
            const eventText = isOpen ? texts[lang].open : texts[lang].closed;
            notify(`${s.name} ${eventText}`, `${s.name} session is now ${isOpen ? 'OPEN' : 'CLOSED'}`);
            statusMap.set(s.name, isOpen);
          }
        } else {
          statusMap.set(s.name, isOpen);
        }

        if (showOpenOnly && !isOpen) return;

        const sessionDiv = document.createElement('div');
        sessionDiv.className = 'session';
        sessionDiv.innerHTML = `
          ${isOpen ? '<div class="live-badge">LIVE</div>' : ''}
          <h3>${s.name}</h3>
          <p>${formatAMPM(open)} ‚Üí ${formatAMPM(close)}</p>
          <p class="${isOpen ? 'open' : 'closed'}">${isOpen ? texts[lang].open : texts[lang].closed}</p>
          <div class="bar">
            <div class="bar-fill" style="width: ${pct}%; background: ${isOpen ? '#4ade80' : '#f87171'};"></div>
          </div>
        `;
        container.appendChild(sessionDiv);

        if (!isOpen && open > now && (!next || open < next.time)) {
          next = { name: s.name, time: open };
        }
      });

      const nextText = document.getElementById('nextSession');
      if (next) {
        const diff = next.time - now;
        const h = String(Math.floor(diff / 3600000)).padStart(2, '0');
        const m = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
        const s = String(Math.floor((diff % 1000) / 100)).padStart(2, '0');
        nextText.textContent = `${texts[lang].next}: ${next.name} ${lang === 'ar' ? 'ÿ™ŸÅÿ™ÿ≠ ÿÆŸÑÿßŸÑ' : 'opens in'} ${h}:${m}:${s}`;
      } else {
        nextText.textContent = '';
      }
    }

    document.getElementById('toggleOpenOnly').addEventListener('click', () => {
      showOpenOnly = !showOpenOnly;
      updateText();
      update();
    });

    document.getElementById('langToggle').addEventListener('click', () => {
      lang = lang === 'en' ? 'ar' : 'en';
      updateText();
      update();
    });

    requestNotificationPermission();
    updateText();
    update();
    setInterval(update, 1000);
  </script>
</body>
</html>
